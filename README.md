# Vue大型项目-----尚品汇

![image-20230601162854726](C:\Users\郭聿良\AppData\Roaming\Typora\typora-user-images\image-20230601162854726.png)

## 项目准备

### 1、关闭eslint校验功能

---

在vue.config.js中：lintOnSave：false

### 2、src文件中简写方法，配置别名

---

以自带，在新的vue-cli中，@代表的是跟目录

### 3、项目路由的分析

---

Home 首页路由组件

Search 搜索路由

Login 登录路由

Register 注册路由

### 4、非路由组件

---

Header（首页、搜索页）

Footer（首页、搜索页）但是在登录页面没有

注意：创建组件的时候，组件结构 + 组件的样式 + 图片资源，咱们项目采用的less样式，浏览器不识别less样式，npm i --s less less-loader@5

### 5、路由组件的搭建

---

1. 安装 vue-router

   npm i --s vue-router@3.5.3

   -components 文件夹：常用于放置非路由组件（共用全局组件）

   -pages/view 文件夹：常用于放置路由组件

2. 配置路由，配置的路由放入 router 文件夹中

3. 路由跳转

   编程式导航：声明式导航能做的编程式导航都能做（但编程式导航除了可以进行路由跳转，还可以做一些其它业务）

4. $route：一般获取路由信息（路径、query、params）

   $router：一般进行编程式导航进行路由跳转

### 6、Footer组件显示与隐藏

---

1. 显示或隐藏组件：v-if 或 v-show

2. Footer组件：在Home、Search 显示 Footer 组件

3. Footer组件：在登录，注册时候隐藏，可以根据组件身上的$route获取当前路由信息，通过路由路径判断Footer 的显示与隐藏

4. 配置的路由的时候，可以给路由添加路由元信息（meta）路由需要配置对象，不能瞎写

5. 如何指定 params 参数可传可不传？

   path : "/search/:id?"

6. params参数传递是空串如何解决？

   params：{id：‘ ’ || undefined}

7. 编程式路由跳转到当前路由（参数不变）多次执行会抛出 Navigation Duplicated 的警告错误

### 7、Home模块组件

---

1. 先把静态页面完成

2. 拆分出静态组件

3. 获取服务器的数据进行展示

4. 动态业务

#### 7.1、三级联动组件完成

由于三级联动，在Home、Search、Detail（详情），把三级联动注册为全局组件。好处：只需注册一次，就可以在项目任意地方是用。完成其余静态组件：HTML + CSS + 图片资源

## 8、对Axios二次封装

1. 为什么要二次封装？

   请求拦截器：可以在发请求之前可以处理一些业务

   响应拦截器：当服务器数据返回以后，处理一些事情

### 8.1、对接口统一管理

1. 项目很小：完全可以在组件的生命周期函数中发请求
2. 项目很大：需要对接口统一管理

会报404错误，因为出现跨域问题

**http://localhost:8080/#/hom**    当前项目的本地服务器

**http://gmall-h5-api.atguigu.cn**     后台服务器

### 8.2、解决跨域：Jsonp  CROS   代理服务器

安装插件 nprogress 对于进度条的使用，思路：只要项目发请求和服务器返回后精度条结束，在哪里使用呢？在请求和响应拦截器里使用

##9、Vuex状态管理

1. vuex基本使用
2. vuex实现模块化开发
   * 扩展到 methods 中：...mapMutations     ...mapActions
   * 扩展到 computed 中：...mapstate     ...mapgetter

## 10、完成TypeNav三级联动展示数据业务

```html
[
	{
   	id:1,
   	name:"电子书",
	chidd:[
		{
			id:2,
			name:"xxx",
			child:[]
			}
		]
	}
]
```



### 10.1、完成以及分类动态添加背影颜色

1. 第一张解决方案：采用样式完成，给item加上：hover（鼠标移入后元素的状态）的背景色
2. 第二种解决方案：JS的排他思想

### 10.2

通过JS控制二、三级商品分类的显示与隐藏最开始的时候，是通过css样式 display：block | nome 显示与隐藏二、三级商品分类

### 10.3、演示卡顿现象

正常：事件触发非常频繁，而且每一次的触发回调函数都要去执行（如果时间）很短，而回调内部存在计算，那么很可能出现浏览器卡顿

节流：在规定的间隔时间范围内不会重复触发回调只有大于这个时间间隔才会触发回调，把频繁触发变为少量触发

防抖：前面的所有触发都被取消，最后一次执行在规定的时间后才会触发，也就是说如果连续快速的触发，只会执行一次

#### 10.3.1、完成三级联动节流的操作

使用lodash库，进行按需引入

### 10.4、完成联动的组件的路由跳转与传递参数

分析：三级联动用产可以点击的：一级分类、二级分类、三级分类

1. Home模块跳转到Search模块，一级会把用户选中的产品（产品的名字、产品的ID）在路由跳转的时候，进行传递

2. 路由跳转的两种方式：

   声明式导航：router-link

   编程式导航：push   replace

3. 三级联动：如果使用声明式导航 router-link，可以实现路由的跳转与传递参数，但出现卡顿现象

4. router-link：是一个组件，当服务器的数据返回之后，循环出很多的router-link组件（创建组件的实例）因为创建组件实例的时候，一瞬间创建1000+很耗内存，出现卡顿现象

#### 10.4.1、完成三级联动路由与传递参数

存在的问题：事件委派，把全部的子节点（h3、dt、dl、em）的事件委派给父亲节点

1. 点击a标签的时候，才回进行路由跳转（怎么能确定点击的一定是a标签）
2. 即使你能确定点击的是a标签，如何区分是一级、二级、三级分类的标签

解决1的问题：使用自定义属性：把子节点当中的a标签，加上自定义属性 data-categoryName，其余的子节点没有

##==第一阶段复习==

1. 商品分类的三级列表由静态变为动态形式（获取服务器数据：解决跨域问题）
2. 函数防抖与节流
3. 路由的跳转：声明式导航，编程式导航（routek-link）









# 第二阶段：完成Search页面

### 1、开发Search模块中的TypeNav商品分类菜单（过渡动画效果）过渡动画：前提组件或元素务必要有 v-if 或 v-show指令才可以进行过渡动画

### 2、对商品分类三级列表进行优化：在APP根组件当中发请求（根组件 mouted）执行一次

### 3、合并参数

### 4、开发Home首页当中的ListContainer组件与Floor组件，mock数据（模拟）：如果你想mock数据，需要用到一个插件mockjs

​	使用步骤：

	1. 在项目中src文件夹中创建mock文件夹
 	2. 准备JSON数据（mock文件夹中创建相应的JSON文件）
 	3. 把mock数据需要的图片放置到public文件夹中（public文件夹在打包时，会把相应的资源原封不动打包到dist文件夹中）
 	4. 开始mock（虚拟的数据）通过mockjs实现
 	5. 创建mockSerer.js通过mock插件实现模拟数据
 	6. 把mockServer.js文件在入口中引入（至少需要执行一次，才能模拟数据）

### 5、ListContainer组件开发重点

安装Swiper插件：安装swiper@5：npm i --s swiper@5

1. 引包（相应JS | CSS）和样式
2. 页面中结构务必要有
3. （页面中务必要有结构）：new Swiper（轮播图添加动态效果）

### 6、发现bug

由于JS事件循环机制导致的bug

1、页面挂载成功后                                                          1、页面挂载成功后

2、向服务器发Ajax请求获取数据         						  2、向服务器发情求拿数据

3、初始化swiper实例                                                      3、修改仓库中的数据

4、修改仓库中的数据                                                      4、初始化swiper实例

1. 方案一：使用宏任务

   给swiper实例加上 setTimeout 函数

2. 方案二：watch数据监听，监听已有数据变化，完美解决方案：watch + nextTick

   netxTick：在下一次DOM更新循环结束之后延迟回调，在修改数据之后立即使用这个方法，获取更新后的DOM

#### 6.1、开发floor组件

切记：仓库当中的state的数据格式不能乱写数据格式，决定于服务器返回的数据

getFloorList这个action在哪里触发？是需要在Home路由组件中发的，不能在Floor组件内部发action，因为我们需要v-f遍历floor组件

#### 6.2、组件通信的方法有哪些？

1. props：用于福字组件通信
2. 自定义事件：@on   @emit  可实现子给父通信
3. 全局事件总线：$bus  全能
4. 茶巢：默认插槽         具名插槽         作用域插槽
5. 消息订阅与发布（pubs-js）：vue中几乎不用全能
6. vuex

#### 6.3、动态展示Floor组件

#### 7.4、把首页当中的轮播图拆分为一个共用全局组件（思维：结构差不多，功能差不多就封装成一个组件）

​		切记：以后再开发项目的时候，如果看到某一个组件在很多地方都使用，把它变成全局组件（优点：注册一次，可以在任意地方使用，共用的组件放到components文件夹中）

## 第二阶段Search模块开发

### 开发步骤

1. 先写静态页面 + 静态组件拆分
2. 发请求（API）
3. vuex（三连环）
4. 组件获取仓库数据，动态展示数据

#### Search仓库中的数据

* attrsList：属性的列表
* goodsList：产品的列表
* trademarkList：品牌的列表
* pageNo：代表分页器页数
* pageSize：每页展示的数据条数
* total：表示数据的总数
* totalpages：代表有多少页





#==小复习==

####1.search模块需要的数据，已请求到，且存储到了vuex仓库当中，且有一些数据已通过getters进行简化，切记：getters为了简化数据而生

#### 2.商品列表，平台售卖属性已动态渲染







### 5、面包屑处理关键字

1. 动态开发面包屑中的分类名，变成思想：就是路由导航跳转（自己跳自己）

2. 动态开发面包屑中的关键字：当面包屑中的关键字清除以后，需要让兄弟组件Header组件中的关键字清除

   怎么清除？设计组件通信

###6、项目小难点：排序操作

需求：1、综合    2、价格    asc：升序     desc：降序

需考虑的问题：

类名：谁应该有类名，通过order属性值当中是包含 | （综合）还是包含2（价格）

谁应该有箭头？谁有类名谁就有箭头

箭头用什么制作？

### 7、项目小难点：==分页器==

是公共组件（Pagination），为什么很多项目采用分页功能：比如电商平台，因为同时展示的数据有很多，会卡顿

#### 7.1、分页器展示，需要哪些数据（条件）？

1. 需要知道当前是第几页：pageNo字段表示当前页数
2. 需要知道每一个需要展示多少条数据：pageSize字段
3. 需要知道整个分页器一共有多少条数据：total表示（获取另外一条信息：共几页》
4. 需要知道分页器连续页面个数：5 | 7（为什么是奇数？对称美）

#### 7.2、自定义分页器，在开发的时候先自己传递假的数据进行调试，调试成功之后再用服务器数据

pageNo：当前第n页       pageSize：每一个展示几条数据     total：整个分页一共展示几条数据

continues：分页连续页码个数

* 对于分页器而言，很重要的一个地方（算出连续页面起始数字和结束的数字）

#### 7.3、分页器动态展示：分为上中下（中间部分）

## 8、开发某一个产品的详情页面

### 8.1

静态组件（详情页的组件：还没有注册为路由组件）当点击商品的图片的时候，跳转到详情页，在路由跳转的时候需要带上产品的ID给详情页面

### 8.2、API

## 9、放大镜

蒙版元素：mask

大图元素：big

==left = event.offsetX - mask.offsetWith / 2==

==top = event.offsetY - mask.offsetHeight / 2==

![image-20230602190120627](C:\Users\郭聿良\AppData\Roaming\Typora\typora-user-images\image-20230602190120627.png)



### 9.1、约束蒙版的范围

```html
if(left <= 0){
             left = 0
       }else if(left >= mask.offsetWidth){
    	     left = mask.offsetWidth
       }
if(top <= 0){
            top = 0
       }else if(top >= mask.offsetHeight){
             top = mask.offsetHeight
      }
```

### 9.2、修改元素的left 与 top 属性值

==mask.style.left = left + 'px'==

==mask.style.top = top + 'px'==

### 9.3、设置大图跟随移动（因为大图是小图的2倍）

==big.style.left = -2 * left + 'px'==

==big.style.top = -2 * top + 'px'==

## 10、开发购物车

1. 路由传参结合会话存储
2. 浏览器存储功能：本地存储：持久化             会话存储：非持久化

### 10.1、引入购物车静态组件

### 10.2、向服务器发情Ajax，获取购物车数据

### 10.3、发现问题

发请求的时候，获取不到购物车里的数据，因为服务器不知道你是谁

### 10.4、解决方案

使用临时游客身份，插件 uuid

## 11、开发登录注册静态组件

assets文件夹：放置全部组件使用的静态资源

先开发注册：注册——通过数据库存储用户信息

登录业务：登录——登录成功的时候，后台为了区分你这个用户是谁，服务器下发token（令牌）

==当用户注册完成，用户登录（用户名 + 密码）向服务器发请求（组件派发action：userLogin），登录成功获取到token，存储与仓库当中（非持久化），路由跳转到home首页==

### 11.1、因此在首页当中（mounted）派发action（getUserInfo）获取用户信息，一级动态展示header组件内容

### 11.2、bug：一刷新Home首页，获取不到用户信息（token：vuex非持久化存储）

所以需要持久化存储token

### 11.3、bug：用户已经登录还能转登录页

## 12、开发trade组件

13700000000     1111111

### 12.1、完成提交订单操作

点击提交订单需发送一次请求

1. 点击提交订单的按钮的时候，还需要向服务器发起一次请求（把支付一些信息传递给服务器），但不使用vuex存储数组（而是将API绑定到vue原型链上）

   ==import * as API from '@/api'==

   ==Vue.prototype.$API = API==

## 13、完成支付页面

1. 使用Element UI + 按需引入

   因为swiper 和 Element UI 版本冲突，需要进行降版本

2. 完成微信支付业务

   下载自动生成二维码的插件：node-qrcode

## 14、完成个人中心（使用二级路由）

## 15、完成未登录的导航守卫判断

* 全局守卫：

  ==未登录访问：交易页面（trade）、支付页面（pay、paysuccess）、用户中心（center）、相关跳转到登录页面==

## 16、完成用户登录（路由独享与组件内守卫）

```html
beforeRouteEnter(to,from,next){
		}

beforeRouteUpadate(to,from){
		}

beforeRouteLeave(to,from){
		}
```

## 17、图片懒加载

https://www.npmJS.com/package/Vue-lazyload

## 18、对表单进行验证

插件：Vee-validata

## 19、路由懒加载

![image-20230602192838297](C:\Users\郭聿良\AppData\Roaming\Typora\typora-user-images\image-20230602192838297.png)